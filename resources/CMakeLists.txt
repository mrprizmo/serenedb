# manual pages
set(MAN_NAMES
  man8/rcserened.8
  man8/serened.8
  )

set(MAN_FILES "") #empty list


foreach (m IN LISTS MAN_NAMES)
    set(msrc ${CMAKE_SOURCE_DIR}/resources/${m})
    set(mdst ${CMAKE_CURRENT_BINARY_DIR}/man/${m})

  add_custom_command(
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
    OUTPUT  ${mdst}
    COMMAND ${CMAKE_SOURCE_DIR}/scripts/manPages.sh ${msrc} ${mdst} ${SERENEDB_VERSION}
    DEPENDS ${msrc}
    COMMENT "Building manpage ${mdst}"
    VERBATIM
    )
  list(APPEND MAN_FILES ${mdst})
endforeach ()
set(SERENEDB_MAN_DIR "${CMAKE_CURRENT_BINARY_DIR}/man" PARENT_SCOPE)

# avoid deleting all generated files on "make clean"...
set_directory_properties(PROPERTIES CLEAN_NO_CUSTOM "On")
# ...but still delete man files
set_property(DIRECTORY APPEND PROPERTY ADDITIONAL_MAKE_CLEAN_FILES ${MAN_FILES})

add_custom_target(man DEPENDS ${MAN_FILES})

add_custom_target(clean_man_autogenerated
  COMMAND rm -f ${MAN_FILES})

list(APPEND CLEAN_AUTOGENERATED_FILES clean_man_autogenerated)
set(CLEAN_AUTOGENERATED_FILES ${CLEAN_AUTOGENERATED_FILES} PARENT_SCOPE)
