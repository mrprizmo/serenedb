name: serenedb_dump_memory_usage
introducedIn: "1.0.0"
help: |
  Current memory usage of all ongoing dump operations on the
  server.
unit: bytes
type: gauge
category: Replication
complexity: simple
exposedBy:
  - coordinator
  - dbserver
  - single
  - agent
description: |
  This metric shows the current memory usage of all ongoing parallel 
  dump operations that are ongoing on the server. It will
  be increased whenever the server-side part of dump requests
  a large block of memory for storing dump results. It will only be
  increased on servers that host at least one of the collections/shards
  that is part of the dump.
  The value will be decreased whenever a dump result was successfully
  transfered to dump and dump has acknowledged its reception.
  The value will also go down when the server-side part of an abandoned 
  dump operation time out and all its data is removed from memory.
  
  This metric will have a value of 0 on Coordinators. The metric will
  not be increased for any dump invocations that did not use the
  `--parallel-dump` option.
troubleshoot: |
  If the peak values reported by this metric are close to the memory
  limit configured via the startup option `--dump.max-memory-usage`,
  this indicates that dumps could operate faster when given more
  memory resources. In this case either increase the value of the
  startup option, which allows the server-side part of dump to
  buffer more results in memory, or reduce the number of batches to 
  prefetch when invoking dump. 
    
  Note also that values reported by this metric may temporarily be
  slightly above the configured memory usage limit to guarantee
  progress of dump operations.
