/* SPDX-License-Identifier: MIT */
#ifndef LIBURING_COMPAT_H
#define LIBURING_COMPAT_H

#cmakedefine LIBURING_CONFIG_HAVE_KERNEL_RWF_T
#cmakedefine LIBURING_CONFIG_HAVE_KERNEL_TIMESPEC
#cmakedefine LIBURING_CONFIG_HAVE_OPEN_HOW
#cmakedefine LIBURING_CONFIG_HAVE_STATX
#cmakedefine LIBURING_CONFIG_HAVE_GLIBC_STATX
#cmakedefine LIBURING_CONFIG_HAVE_FUTEXV
#cmakedefine LIBURING_CONFIG_HAVE_IDTYPE_T
#cmakedefine LIBURING_CONFIG_HAVE_DISCARD_CMD

#ifndef LIBURING_CONFIG_HAVE_KERNEL_RWF_T
typedef int __kernel_rwf_t;
#endif

#ifndef LIBURING_CONFIG_HAVE_KERNEL_TIMESPEC
#include <stdint.h>

struct __kernel_timespec {
	int64_t		tv_sec;
	long long	tv_nsec;
};

/* <linux/time_types.h> is not available, so it can't be included */
#define UAPI_LINUX_IO_URING_H_SKIP_LINUX_TIME_TYPES_H 1
#else
#include <linux/time_types.h>
/* <linux/time_types.h> is included above and not needed again */
#define UAPI_LINUX_IO_URING_H_SKIP_LINUX_TIME_TYPES_H 1
#endif

#ifndef LIBURING_CONFIG_HAVE_OPEN_HOW
#include <inttypes.h>

struct open_how {
	uint64_t	flags;
	uint64_t	mode;
	uint64_t	resolve;
};
#else
#include <linux/openat2.h>
#endif

#if !defined(LIBURING_CONFIG_HAVE_GLIBC_STATX) && defined(LIBURING_CONFIG_HAVE_STATX)
#include <sys/stat.h>
#endif

#ifndef LIBURING_CONFIG_HAVE_FUTEXV
#include <inttypes.h>

#define FUTEX_32	2
#define FUTEX_WAITV_MAX	128

struct futex_waitv {
	uint64_t	val;
	uint64_t	uaddr;
	uint32_t	flags;
	uint32_t	__reserved;
};
#endif

#ifndef LIBURING_CONFIG_HAVE_IDTYPE_T
typedef enum
{
  P_ALL,		/* Wait for any child.  */
  P_PID,		/* Wait for specified process.  */
  P_PGID		/* Wait for members of process group.  */
} idtype_t;
#endif

#if !defined(LIBURING_CONFIG_HAVE_DISCARD_CMD)
#include <linux/ioctl.h>

#ifndef BLOCK_URING_CMD_DISCARD
#define BLOCK_URING_CMD_DISCARD                        _IO(0x12, 0)
#endif
#else
#include <linux/blkdev.h>
#endif

#endif
